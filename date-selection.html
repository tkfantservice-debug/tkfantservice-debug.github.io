<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Select Service Date</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="date-selection-page">
    <!-- Header Navigation -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-box">
                        <img src="your-logo.png" alt="Company Logo" class="logo-img">
                    </div>
                </div>
                <nav class="nav-desktop">
                    <a href="index.html#hero" class="nav-link">Home</a>
                    <a href="password.html" class="nav-link">Service Report</a>
                    <a href="index.html#contact" class="nav-link">Contact Us</a>
                </nav>
                <button class="mobile-menu-btn" id="mobileMenuBtn">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
            <nav class="nav-mobile" id="mobileMenu">
                <a href="index.html#hero" class="nav-link">Home</a>
                <a href="password.html" class="nav-link">Service Report</a>
                <a href="index.html#contact" class="nav-link">Contact Us</a>
            </nav>
        </div>
    </header>

    <!-- Date Selection Section - Centered -->
    <div class="date-selection-page-wrapper">
        <section class="hero date-selection-hero">
            <div class="container">
                <div class="password-container transparent-container">
                    <h1 class="title">Select Service Date</h1>
                    <p class="company-name" id="companyDisplay">Loading company...</p>
                    
                    <!-- Service Schedule Info -->
                    <div class="service-schedule-info">
                        <div class="schedule-item">
                            <span class="schedule-label">üìÖ Last Service Date:</span>
                            <span class="schedule-value" id="lastServiceDate">Loading...</span>
                        </div>
                        <div class="schedule-item">
                            <span class="schedule-label">üîî Next Service Date:</span>
                            <span class="schedule-value" id="nextServiceDate">Loading...</span>
                        </div>
                        <div class="schedule-item days-remaining" id="daysRemainingContainer" style="display: none;">
                            <span class="schedule-label">‚è∞ Days Remaining:</span>
                            <span class="schedule-value" id="daysRemaining">-</span>
                        </div>
                    </div>

                    <!-- Date Selection Section with Container -->
                    <div class="date-section">
                        <p style="color: white; text-align: center; margin-bottom: 1.5rem; font-size: 1rem; font-weight: 500;">
                            üëá Click on a service date below to view reports
                        </p>

                        <!-- Date List Container with defined background -->
                        <div class="date-list-container">
                            <div id="dateList" class="date-list">
                                <!-- Dates will be generated here by JavaScript -->
                                <div style="color: white; text-align: center; padding: 2rem;">
                                    Loading service history...
                                </div>
                            </div>
                        </div>
                    </div>

                    <button type="button" id="backButton" class="back-button" style="margin-top: 2rem;">
                        ‚Üê BACK TO LOGIN
                    </button>
                </div>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 TK FANTASTIC SDN. BHD. All rights reserved.</p>
        </div>
    </footer>

    <!-- Load Company Data -->
    <script src="companyData.js"></script>
    
    <!-- Page Script -->
    <script>
        // ==================== AUTHENTICATION CHECK ====================
        const authenticated = localStorage.getItem('authenticated');
        const authUsername = localStorage.getItem('authUsername');
        const authCompany = localStorage.getItem('authCompany');

        if (!authenticated || !authUsername || !authCompany) {
            window.location.href = 'password.html';
        }

        // ==================== LOAD DATA ====================
        const companyDisplay = document.getElementById('companyDisplay');
        const lastServiceDateEl = document.getElementById('lastServiceDate');
        const nextServiceDateEl = document.getElementById('nextServiceDate');
        const daysRemainingEl = document.getElementById('daysRemaining');
        const daysRemainingContainer = document.getElementById('daysRemainingContainer');
        const dateList = document.getElementById('dateList');

        // Get company data using the username
        const company = findCompanyByUsername(authUsername);

        if (company) {
            // Display the full company name
            companyDisplay.textContent = company.displayName;

            // Display last service date
            if (company.lastServiceDate) {
                lastServiceDateEl.textContent = formatDate(company.lastServiceDate);
            } else {
                lastServiceDateEl.textContent = 'N/A';
            }

            // Display next service date
            if (company.nextServiceDate) {
                nextServiceDateEl.textContent = formatDate(company.nextServiceDate);
                
                // Calculate and display days remaining
                const daysUntil = calculateDaysUntil(company.nextServiceDate);
                if (daysUntil !== null) {
                    daysRemainingContainer.style.display = 'flex';
                    
                    if (daysUntil < 0) {
                        daysRemainingEl.textContent = `Overdue by ${Math.abs(daysUntil)} days`;
                        daysRemainingEl.style.color = '#ff6b6b';
                        daysRemainingEl.style.fontWeight = 'bold';
                    } else if (daysUntil === 0) {
                        daysRemainingEl.textContent = 'Today!';
                        daysRemainingEl.style.color = '#ffd93d';
                        daysRemainingEl.style.fontWeight = 'bold';
                    } else if (daysUntil <= 30) {
                        daysRemainingEl.textContent = `${daysUntil} days (Due Soon!)`;
                        daysRemainingEl.style.color = '#ffd93d';
                        daysRemainingEl.style.fontWeight = 'bold';
                    } else {
                        daysRemainingEl.textContent = `${daysUntil} days`;
                        daysRemainingEl.style.color = '#6bcf7f';
                    }
                }
            } else {
                nextServiceDateEl.textContent = 'N/A';
            }

            // Load service dates using username
            const serviceDates = getServiceDates(authUsername);

            if (serviceDates && serviceDates.length > 0) {
                // Clear loading message
                dateList.innerHTML = '';
                
                serviceDates.forEach(date => {
                    const button = document.createElement('button');
                    button.className = 'date-button';
                    button.textContent = formatDate(date);
                    
                    button.onclick = () => {
                        localStorage.setItem('selectedDate', date);
                        window.location.href = 'fan-selection.html';
                    };
                    
                    dateList.appendChild(button);
                });
            } else {
                dateList.innerHTML = '<div class="no-data-message">No service records found for this company.</div>';
            }
        } else {
            // Company not found, redirect to login
            window.location.href = 'password.html';
        }

        // ==================== MOBILE MENU ====================
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const mobileMenu = document.getElementById('mobileMenu');

        if (mobileMenuBtn && mobileMenu) {
            mobileMenuBtn.addEventListener('click', () => {
                mobileMenu.classList.toggle('active');
            });

            const mobileLinks = mobileMenu.querySelectorAll('.nav-link');
            mobileLinks.forEach(link => {
                link.addEventListener('click', () => {
                    mobileMenu.classList.remove('active');
                });
            });
        }

        // ==================== BACK BUTTON ====================
        document.getElementById('backButton')?.addEventListener('click', function() {
            localStorage.removeItem('authenticated');
            localStorage.removeItem('authUsername');
            localStorage.removeItem('authCompany');
            localStorage.removeItem('companyName');
            window.location.href = 'password.html';
        });
    </script>
</body>
</html>
